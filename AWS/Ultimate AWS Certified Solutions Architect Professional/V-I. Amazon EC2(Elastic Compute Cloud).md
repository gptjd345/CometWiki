# I. EC2 Instance Types (EC2 인스턴스 유형)
p 176

- **R(RAM)**
    - RAM 성능이 많이 필요한 애플리케이션(메모리 집약적인 작업에 최적화)
    - ex) in-memory caches / databases
- **C(CPU)**
    - CPU 성능이 많이 필요한 애플리케이션(CPU 집약적인 작업에 최적화)
    - ex) compute / databases
- **M(Medium)**
    - 균형 잡힌 성능이 필요한 애플리케이션(CPU와 메모리의 균형이 잘 잡혀 있음)
    - ex) general / web app
- **I(I/O)**
    - 로컬 I/O 연산이 많이 필요한 애플리케이션(인스턴스 스토리지에 최적화)
    - ex) 고성능 databases / 데이터 웨어하우징
- **G(GPU)**
    - GPU 성능이 많이 필요한 애플리케이션
    - ex) video rendering / machine learning
- **T2 / T3**: 버스트 가능한 인스턴스(최대 용량)
- **T2 / T3 - unlimited** : 무제한 버스트
    - 버스트(Burst)는 컴퓨팅 리소스, 특히 CPU 성능이 일시적으로 증가하는 것을 의미


# II. EC2 Placement Groups (EC2 배치 그룹)
p 177

[https://docs.aws.amazon.com/ko_kr/AWSEC2/latest/UserGuide/placement-groups.html](https://docs.aws.amazon.com/ko_kr/AWSEC2/latest/UserGuide/placement-groups.html)

배치 그룹에는 클러스터, 분산, 파티션의 3종류가 존재한다.

- **Cluster(클러스터)**
	- 단일 가용성 영역(AZ) 내에서 인스턴스를 저지연 그룹으로 클러스터링
- **Spread(분산)**
	- 인스턴스 그룹을 각각의 고유한 하드웨어 전체로 확산(AZ당 최대 7개의 인스턴스)
	- 중요 애플리케이션
- **Partition(파티션)**
	- AZ 내의 다양한 파티션(다른 랙 세트에 따라 다름)에 인스턴스를 확산
	- 그룹당 EC2 인스턴스를 100s로 확장 가능(Hadoop, Cassandra, Kafka)

### ❓인스턴스를 배치 그룹으로 이동하거나 배치 그룹 밖으로 이동하는 방법
1. 인스턴스를 중지한다.
2. 중지 후, CLI를 사용하여 인스턴스의 배치 그룹을 수정한다.
    - **명령어**: `aws ec2 modify-instance-placement`
3. 변경 사항을 적용한 후, 인스턴스를 다시 시작한다.


# III. EC2 Placement Strategies (EC2 배치 전략)
p 178 - 180

[https://docs.aws.amazon.com/ko_kr/AWSEC2/latest/UserGuide/placement-strategies.html](https://docs.aws.amazon.com/ko_kr/AWSEC2/latest/UserGuide/placement-strategies.html)
[https://merrily-code.tistory.com/233](https://merrily-code.tistory.com/233)

배치 전략에 따라 AZ 또는 랙 내에서 인스턴스가 배치되는 방법이 달라진다.
## **1. Cluster (클러스터)**

동일한 AZ, 동일한 랙(rack) 안에 인스턴스를 배치하는 전략
<font color="#92d050">* 랙(rack): 데이터 센터 내에서 서버와 네트워크 장비를 물리적으로 배치하는 구조</font>

![[EC2-Placement-Strategies_cluster 1.png]]

- **장점**
    - **우수한 네트워크 성능**: Enhanced Networking을 활성화한 인스턴스 간의 대역폭이 최대 10Gbps에 달한다.
        - **Enhanced Networking**: 네트워크 성능을 향상시키기 위해 Amazon EC2에서 제공하는 기능으로, 높은 패킷 처리량과 낮은 지연 시간을 제공한다.
    - **낮은 지연 시간**: 인스턴스들이 물리적으로 가까운 위치에 배치되어 네트워크 지연 시간이 최소화된다.
    - **높은 네트워크 처리량**: 대량의 데이터 전송이 필요한 작업에서 높은 네트워크 처리량을 제공한다.
- **단점**
    - **단일 장애점**: 랙에 장애가 발생하면 모든 인스턴스가 동시에 장애를 겪을 수 있다.
        - **랙 장애**: 물리적 하드웨어나 네트워크 장비의 문제가 발생할 경우, 해당 랙에 배치된 모든 인스턴스가 영향을 받는다. → 낮은 가용성
        - **고가용성 문제**: 특정 랙에 모든 인스턴스를 집중 배치하므로, 고가용성 요구사항을 충족하기 어려울 수 있다.
- **사용 사례**
    - **빅 데이터 작업**:
        - **특징**: 대량의 데이터를 빠르게 처리해야 하는 작업.
        - **예시**: 데이터 분석, 머신 러닝 모델 학습 등.
    - **매우 낮은 지연 시간과 높은 네트워크 처리량이 필요한 애플리케이션**:
        - **특징**: 실시간 처리나 고성능 네트워킹이 필요한 애플리케이션.
        - **예시**: 고성능 컴퓨팅(HPC), 금융 거래 시스템, 실시간 게임 서버 등.

클러스터 배치 그룹 전략은 매우 낮은 지연 시간과 높은 네트워크 처리량을 제공하여 고성능이 필요한 애플리케이션에 적합하다. 그러나 단일 장애점이 존재하므로, 고가용성이 중요한 경우에는 다른 배치 전략과 함께 사용하거나 가용성 영역(AZ)을 분산하여 배치하는 등의 추가적인 고가용성 설계를 고려해야 한다.

## **2. Spread (분산)**

랙 당 하나의 인스턴스를 배치하고, 여러 AZ에 분산하는 배치 전략

![[EC2-Placement-Strategies_spread.png]]

- **장점**
    - **높은 가용성**: 여러 가용성 영역(AZ) 전반에 걸쳐 인스턴스를 배치할 수 있어, 특정 가용성 영역의 장애로부터 보호할 수 있다.
    - **동시 고장 위험 감소**: 인스턴스가 서로 다른 물리적 하드웨어에 배치되므로, 하나의 하드웨어 장애가 전체 시스템에 영향을 미치지 않는다.
    - **독립성 보장**: 각 인스턴스가 서로 다른 물리적 하드웨어에 배치되므로, 인스턴스 간에 장애가 전파되지 않는다.
- **단점**
    - **제한된 인스턴스 수**: 각 가용성 영역(AZ)당 퍼져요 배치 그룹 내에 최대 7개의 인스턴스만 배치할 수 있다.
        - **제한**: 대규모 애플리케이션을 운영하는 경우, 이 제한이 배포 전략에 영향을 미칠 수 있다.
- **사용 사례**
    - **고가용성을 극대화해야 하는 애플리케이션**:
        - **특징**: 항상 서비스를 제공해야 하고, 장애가 발생하더라도 서비스 중단을 최소화해야 하는 애플리케이션.
        - **예시**: 금융 서비스, 의료 시스템 등.
    - **각 인스턴스를 서로의 장애로부터 분리해야 하는 중요한 애플리케이션**:
        - **특징**: 하나의 인스턴스 장애가 다른 인스턴스에 영향을 미치지 않도록 설계해야 하는 애플리케이션.
        - **예시**: 데이터베이스 서버, 중요한 애플리케이션 서버 등.
- **종류**
    - **랙 레벨 분산 배치 그룹**
        동일한 리전의 여러 가용 영역에 적용될 수 있으며, 그룹당 가용 영역별로 최대 7개의 실행 중인 인스턴스를 가질 수 있다. Oposts를 사용하면, Outpost 배포에 있는 랙 수만큼의 인스턴스를 보유할 수 있다.
        
    - **호스트 레벨 분산형 배치 그룹**
        AWS Outposts에서만 사용할 수 있는 기능으로, Outpost 배포에 있는 호스트의 개수만큼의 인스턴스를 보유할 수 있다.
        

각 인스턴스를 서로 다른 물리적 하드웨어에 배치하여 단일 장애점(Single Point of Failure)을 최소화하는 배치 전략이다. 이를 통해 인스턴스 간의 독립성을 높이고, 가용성을 극대화한다. 다만, 가용성 영역당 인스턴스 수에 제한이 있으므로, 대규모 애플리케이션을 운영할 때는 이 점을 고려해야 한다.

## **3. Partition (파티션)**

여러 AZ 안에 파티션을 두고, 파티션 안에서 여러 인스턴스를 클러스터 전략처럼 배치할 수 있는 전략

![[EC2-Placement-Strategies_partition.png]]

- **특징**
    - **AZ당 최대 7개의 파티션**: 하나의 가용 영역(AZ) 내에서 최대 7개의 파티션을 생성할 수 있다.
    - **최대 100개의 EC2 인스턴스**: 한 파티션 배치 그룹 내에서 최대 100개의 EC2 인스턴스를 배포할 수 있다.
    - **파티션 간 독립성**: 하나의 파티션 내 인스턴스는 다른 파티션의 인스턴스와 물리적 랙을 공유하지 않는다. 즉, 하나의 파티션에 장애가 발생해도 다른 파티션에 영향을 미치지 않는다.
    - **메타데이터로 파티션 정보 접근 가능**: EC2 인스턴스는 메타데이터를 통해 자신이 속한 파티션 정보를 확인할 수 있다.
- **장점**
    - **장애 격리**: 파티션 구조를 통해 특정 파티션에 장애가 발생하더라도 다른 파티션에는 영향을 미치지 않으므로, 고가용성을 유지할 수 있다.
    - **데이터 분산 및 복제**: HDFS, HBase, 카산드라 같은 분산 시스템에서 데이터 분산 및 복제를 쉽게 관리할 수 있다.
- **단점**
    - **설계 복잡성**: 파티션을 효율적으로 설계하는 데에 시간이 걸릴 수 있다.
    - **제약 조건**: 파티션 수와 인스턴스 수에 제한이 있다.
- 사용 사례
	- **HDFS (Hadoop Distributed File System)**: 대규모 데이터 분산 저장 및 처리를 위한 분산 파일 시스템.
	- **HBase**: 대규모 데이터 저장을 위한 분산형 비관계형 데이터베이스.
	- **Apache Cassandra (카산드라)**: 확장성과 고가용성을 제공하는 분산형 NoSQL 데이터베이스.

파티션 배치 그룹은 대규모 분산 시스템에서 데이터 복제 및 장애 격리를 효과적으로 관리할 수 있는 방법을 제공한다. 이러한 구조는 HDFS, HBase, 카산드라와 같은 시스템에서 특히 유용하다. 파티션 배치 그룹을 활용하면 특정 파티션에 장애가 발생하더라도 다른 파티션에 영향을 미치지 않아 시스템의 고가용성을 유지할 수 있다.


# IV. EC2 Instance Launch Types (EC2 인스턴스 시작 유형)

p 181

## 1. On-Demand Instances (온 디맨드 인스턴스)
- **특징**: 필요할 때 인스턴스를 시작하고 사용한 만큼만 비용을 지불하는 방식.
- **장점**: 초기 비용 없이 사용 가능, 유연성 및 확장성 제공.
- **단점**: 장기적으로는 비용이 높을 수 있음.
- 사용 사례: 짧은 워크로드, 예측 가능한 가격, 신뢰성이 중요한 경우.

## 2. Spot Instances (스팟 인스턴스)
- **특징**: AWS의 유휴 컴퓨팅 자원을 저렴한 비용으로 사용할 수 있는 방식.
- **장점**: 매우 저렴한 비용.
- **단점**: 신뢰할 수 없음, 인스턴스가 예고 없이 종료될 수 있음.
- **사용 사례**: 짧은 워크로드로 인스턴스가 예고 없이 종료될 수 있는 작업. (예: 배치 처리, 데이터 분석)

## 3. Reserved
- 최소 1년
- 최고 할인 -> 최저 할인: 모든 선불 > 부분 선불 > 선불 없음
    
    ### 3-1. Reserved Instances (예약 인스턴스)
    - **특징**: 최소 1년 동안 인스턴스를 예약하여 할인된 가격으로 사용하는 방식.
    - **장점**: 온 디맨드 인스턴스보다 저렴한 비용.
    - **단점**: 장기 계약 필요, 유연성 제한.
	- **사용 사례**: 긴 워크로드가 예상되는 경우.
        
    ### 3-2. Convertible Reserved Instances
    - **특징**: 예약 인스턴스의 유연한 버전으로, 예약 기간 동안 인스턴스 유형을 변경할 수 있음.
    - **장점**: 인스턴스 유형 변경 가능, 할인된 가격.
    - **단점**: 일반 예약 인스턴스보다 할인율이 낮을 수 있음.
    - **사용 사례**: 긴 워크로드가 예상되지만 인스턴스 유형의 유연성이 필요한 경우.

## 4. Dedicated Instances (전용 인스턴스)
- **특징**: 다른 고객과 하드웨어를 공유하지 않는 인스턴스.
- **장점**: 보안 및 격리 제공.
- **단점**: 비용이 높음.
- **사용 사례**: 보안 및 규제 요구 사항으로 인해 하드웨어 격리가 필요한 경우.

## 6. Dedicated Hosts (전용 호스트)
- **특징**: 전체 물리적 서버를 예약하여 인스턴스 배치 및 물리적 서버 제어 가능.
- **장점**: 인스턴스 배치 제어, 특정 라이센스 요구 사항 충족, 호스트 선호도 정의 가능.
- **단점**: 매우 높은 비용.
- **사용 사례**: 코어 또는 CPU 소켓 수준에서 작동하는 소프트웨어 라이센스에 적합, 특정 규제 요구 사항이 있는 경우.

온 디맨드 인스턴스는 유연성과 신뢰성이 높지만 비용이 비쌀 수 있고, 스팟 인스턴스는 매우 저렴하지만 신뢰성이 낮다. 예약 인스턴스와 Convertible Reserved 인스턴스는 장기 워크로드에 적합하며, 전용 인스턴스와 전용 호스트는 보안 및 규제 요구 사항을 충족한다. 


# V. EC2 Graviton

p 182

AWS Graviton 프로세서는 AWS에서 자체 설계한 ARM 기반 프로세서로, 뛰어난 가격 대비 성능을 제공하는 것이 특징이다. Graviton, Graviton2, Graviton3 세대가 있으며, 각 세대는 이전 세대보다 성능과 효율성이 크게 향상되었다.

## 1. AWS Graviton 특징

- **Graviton 프로세서**
    - **최고의 가격 성능**: AWS Graviton 프로세서는 뛰어난 가격 대비 성능을 제공한다.
    - **지원 OS**: 다양한 리눅스 운영 체제 (Amazon Linux 2, RedHat, SUSE, Ubuntu)를 지원한다. 다만, 윈도우즈 인스턴스에서는 사용할 수 없다.
- **Graviton2**
    - **가격 성능**: 동급 x86 기반 인스턴스보다 40% 향상된 가격 성능을 제공한다.
    - **사용 사례**: 앱 서버, 마이크로서비스, 고성능 컴퓨팅(HPC), CPU 기반 머신러닝, 비디오 인코딩, 게임, 인메모리 캐시 등.
- **Graviton3**
    - **성능**: Graviton2 대비 최대 3배 향상된 성능을 제공한다.
    - **사용 사례**: Graviton2와 유사한 사용 사례에 더 높은 성능 요구 사항이 있는 작업에 적합하다.

## 2. 사용 사례

- **앱 서버**: 웹 애플리케이션을 호스팅하는 서버.
- **마이크로서비스**: 작은 독립적 서비스로 구성된 애플리케이션.
- **고성능 컴퓨팅(HPC)**: 복잡한 연산 작업을 수행하는 컴퓨팅.
- **CPU 기반 머신러닝**: CPU를 활용한 머신러닝 작업.
- **비디오 인코딩**: 비디오 파일을 다른 형식으로 변환하는 작업.
- **게임**: 온라인 게임 서버.
- **인메모리 캐시**: 빠른 데이터 접근을 위해 메모리에 데이터를 저장하는 시스템.

AWS Graviton 프로세서는 ARM 기반의 고성능, 저비용 프로세서로, 다양한 리눅스 운영 체제와 호환된다. Graviton2는 동급 x86 인스턴스 대비 40% 향상된 가격 성능을 제공하며, Graviton3는 Graviton2 대비 최대 3배 향상된 성능을 제공한다.
Graviton 프로세서는 앱 서버, 마이크로서비스, 고성능 컴퓨팅, CPU 기반 머신러닝, 비디오 인코딩, 게임, 인메모리 캐시 등 다양한 사용 사례에 적합하다.
<font color="#92d050">* ARM(Adavanced RISC Machine): RISC 아키텍처 기반의 중앙 처리 장치(CPU) 제품군</font>
<font color="#92d050">* RISC (Reduced Instruction Set Computer): 복잡한 명령어를 제거하여 사용빈도가 높은 명령어 위주로 처리속도를 향상한 프로세서, 컴퓨터의 실행 속도를 높이기 위해 복잡한 처리는 소프트웨어에게 맡기는 방법을 채택</font>


# VI. EC2 included metrics
p 183

[https://docs.aws.amazon.com/ko_kr/AWSEC2/latest/UserGuide/US_SingleMetricPerInstance.html](https://docs.aws.amazon.com/ko_kr/AWSEC2/latest/UserGuide/US_SingleMetricPerInstance.html)

AWS EC2 인스턴스는 다양한 메트릭을 모니터링하여 인스턴스의 상태와 성능을 파악할 수 있다. 여기에는 CPU, 네트워크, 상태 확인, 디스크 관련 메트릭이 포함된다. 다만, RAM 사용량은 기본 제공 메트릭에 포함되지 않는다.

## 1. CPU

```
💡 AWS Burst(버스트) 
- EC2 인스턴스 유형 중 Burstable Instance (성능 순간 확장 가능 인스턴스)에서 사용할 수 있는 기능 
- 일정 기간 동안 인스턴스의 CPU 용량을 잠재적으로 초과하는 능력을 제공하여 예기치 않은 작업 부하에 대한 대처 가능 
- 기준 CPU와 추가 버스트 CPU 사용량에 대해서만 비용을 지불하면 되므로 컴퓨팅 비용이 절감 
	- 인스턴스가 기본 CPU 크기보다 높은 CPU 사용량을 일시적으로 처리 한다는 것 
	- CPU를 더 큰 인스턴스로 업그레이드 할 필요 없어 효율적임 
	- CPU 크레딧 사용함 
```
[https://chance-story.tistory.com/66](https://chance-story.tistory.com/66)


```
💡 CPU Credit(CPU 크레딧)
- 시간당 CPU 용량, vCPU 시간의 단위 
- 인스턴스가 활성화 되어 있을 때 CPU 크레딧이 충분하지 않으면 인스턴스의 CPU 사용량이 기본 CPU 크기로 제한 됨 
- 트래픽이 적을 때는 CPU 크레딧을 충전하고, 높아지면 CPU 크레딧을 사용하여 인스턴스를 버스트 모드로 전환할 수 있음 
	- CPU 크레딧은 일정 비율로 충전됨 
	- 사용자가 CPU 사용량을 얼마나 조절하는지에 따라 충전되는 속도가 결정됨 
- 주의할 점 : 인스턴스가 활성화 되어 있는 동안만 CPU 크레딧이 충전됨
```
[https://docs.aws.amazon.com/ko_kr/AWSEC2/latest/UserGuide/burstable-credits-baseline-concepts.html](https://docs.aws.amazon.com/ko_kr/AWSEC2/latest/UserGuide/burstable-credits-baseline-concepts.html) [https://itwiki.kr/w/AWS_CPU_버스트](https://itwiki.kr/w/AWS_CPU_%EB%B2%84%EC%8A%A4%ED%8A%B8)

- - **CPU: CPU Utilization + Credit Usage / Balance**
- **CPU Utilization(CPU 사용률)**: 인스턴스당 CPU 사용량
- **CPU Credit Usage(CPU 크레딧 사용률)**: 사용한 CPU 크레딧
- **CPU Credit Balance(CPU 크레딧 밸런스)**: 사용 가능한 CPU 크레딧 잔여량

## 2. Network

- **Network: Network In / Out(네트워크 입력/출력)**
- **Network In(네트워크 입력)**: 인스턴스로 들어오는 네트워크 트래픽 측정
- **Network Out(네트워크 출력)**: 인스턴스에서 나가는 네트워크 트래픽 측정

## 3. Status Check(상태 확인)

[https://docs.aws.amazon.com/ko_kr/AWSEC2/latest/UserGuide/monitoring-system-instance-status-check.html](https://docs.aws.amazon.com/ko_kr/AWSEC2/latest/UserGuide/monitoring-system-instance-status-check.html)

- **Instance Status(인스턴스 상태)**
    - EC2 VM의 상태 확인.
    - 인스턴스 자체의 소프트웨어와 네트워크 설정 검사
- **System Status(시스템 상태)**
    - 기본 하드웨어의 상태 확인.
    - 인스턴스가 실행되는 물리적 호스트의 상태 검사

## 4. Disk

- **Read/Write Ops/Bytes(읽기/쓰기)**
    - 인스턴스 스토어의 경우에만 해당
    - 디스크의 읽기 및 쓰기 작업 수와 바이트 수를 측정한다.

## 5. 제외된 메트릭

- **RAM 사용률**: RAM 사용량과 관련된 메트릭은 기본 제공되지 않는다. RAM 사용량을 모니터링하려면 별도의 에이전트를 설치하거나 CloudWatch 커스텀 메트릭을 설정해야 한다.

AWS EC2 인스턴스는 CPU 사용률, 네트워크 입력/출력, 상태 확인(인스턴스 상태 및 시스템 상태), 디스크 읽기/쓰기 메트릭을 제공한다. RAM 사용률은 기본 제공 메트릭에 포함되지 않으며, 이를 모니터링하려면 추가 설정이 필요하다. 이러한 메트릭을 통해 인스턴스의 성능과 상태를 효과적으로 모니터링할 수 있다.


# VII. EC2 Instance Recovery
p 184

https://docs.aws.amazon.com/ko_kr/AWSEC2/latest/UserGuide/ec2-instance-recover.html

AWS EC2 인스턴스의 복구 절차는 인스턴스 상태와 시스템 상태를 확인하고, 문제가 발생했을 때 인스턴스를 복구하는 과정을 포함한다. 복구 시 인스턴스의 네트워크 설정 및 메타데이터 등이 유지된다.

### ❓ EC2 인스턴스 복구 절차
![[EC2-Instance-Recovery.png]]
- EC2 Instance <-- monitor / Recovery -- ClouldWhatch Alarm (StatusCheckFailed_System)
- https://repost.aws/ko/knowledge-center/automatic-recovery-ec2-cloudwatch
- https://heewon0704.tistory.com/14

### ❓ Amazon CloudWatch
AWS 리소스와 애플리케이션을 모니터링하고, 다양한 메트릭스와 로그를 수집하여 알람을 생성할 수 있는 서비스이다. CloudWatch Alarm을 사용하여 특정 조건이 충족될 때 자동으로 복구 작업을 수행하도록 설정할 수 있다.

## 1. Status Checks(상태 확인)
1. **Instance Status(인스턴스 상태)**
    - 해당 인스턴스의 시스템 상태 확인 실패
    - EC2의 네트워크 구성이 잘못됨
    - 메모리가 모두 사용됨
    - 파일 시스템 손상
    - 호환되지 않는 커널
2. **System Status(시스템 상태)**
    - 물리적 네트워크 연결 끊김
    - 시스템 전원 중단
    - 호스트의 소프트웨어 문제
    - 호스트의 하드웨어 문제

## 2. 복구
- **복구 조치**: 인스턴스가 비정상 상태일 때, AWS는 자동으로 인스턴스를 복구할 수 있다. 복구 과정에서는 다음 항목들이 유지된다:
    - **Private IP Address (개인 IP 주소)**: 인스턴스에 할당된 개인 IP 주소가 유지된다.
    - **Public IP Address (공용 IP 주소)**: 탄력적 IP(Elastic IP)를 사용하고 있는 경우, 공용 IP 주소도 유지된다.
    - **Elastic IP Address (탄력적 IP 주소)**: 탄력적 IP는 인스턴스가 복구된 후에도 동일하게 유지된다.
    - **Metadata (메타데이터)**: 인스턴스의 메타데이터와 사용자 데이터는 변경되지 않는다.
    - **Placement Group (배치 그룹)**: 인스턴스가 배치 그룹에 속해 있는 경우, 복구 후에도 동일한 배치 그룹에 속하게 된다.

