
### 사전지식 1.  *IAM vs STS*(Security Token Service)

#### ***STS***(Security Token Service) 란? #IAM/STS

**STS(Security Token Service)는 특정 시간 동안만 유효한 임시 보안 자격 증명이다. 

주로 임시 접근이 필요하거나 외부 사용자에게 접근 권한을 부여해야하는 상황에서 사용된다. 

### 사용사례
* **<font color="#de7802">연합 사용자 접근 (Federation Access)</font>** : 회사의 직원, 제3자 서비스 사용자 등이 AWS 리소스에 접근해야하는 경우, STS 를 사용하여 임시자격 증명을 발급받을 수 있다.

* **<font color="#de7802">교차 계정 액세스 (Cross-Account Access)</font>** : 다른 AWS 계정의 리소스에 접근해야하는 경우 , 예를 들면 
계정 A의 애플리케이션이 계정 B의 S3 버킷에 접근해야할 때 , 계정 A에서 STS를 사용하여 계정 B에서 임시 자격 증명을 발급받아 접근 할 수 있다.

*  <font color="#de7802">모바일 앱 및 웹 애플리케이션 </font>
모바일 앱이나 웹 애플리케이션이 직접 AWS 리소스에 접근해야 할 때, STS 를 사용하여 임시 자격 증명을 발급 받을 수 있다. 예를 들면 모바일 앱에서 사용자 인증 후 STS를 통해 임시 자격 증명을 받아 S3버킷에 파일을 업로드하거나 다운로드 할 수 있다. 

<font color="#00b050"><u>Python Boto3 라이브러리를 사용하여 STS를 통해 임시 자격 증명을 요청하고 이를 사용하는 예시 </u></font>
```python
import boto3

# STS 클라이언트 생성
sts_client = boto3.client('sts')

# 다른 역할의 임시 자격 증명 요청
response = sts_client.assume_role(
    RoleArn='arn:aws:iam::123456789012:role/other-role',  # 접근하려는 역할의 ARN
    RoleSessionName='other-role-session',                 # 세션 이름
    DurationSeconds=3600                                  # 자격 증명의 유효 기간 (최대 1시간)
)

# 임시 자격 증명 추출
credentials = response['Credentials']
access_key = credentials['AccessKeyId']
secret_key = credentials['SecretAccessKey']
session_token = credentials['SessionToken']

# 임시 자격 증명을 사용하여 다른 서비스 클라이언트 생성
s3_client = boto3.client(
    's3',
    aws_access_key_id=access_key,
    aws_secret_access_key=secret_key,
    aws_session_token=session_token
)

# S3 버킷 목록 가져오기
response = s3_client.list_buckets()
buckets = [bucket['Name'] for bucket in response['Buckets']]

print("S3 Buckets:", buckets)
```


#### *IAM* 이란? #IAM/IAM이란

IAM은 사용자, 그룹, 역할(Role)을 생성하고 이들에게 영구적인 자격증명을 할당한다. 
한번 생성된 자격증명은 명시적으로 회수되기 전까지 유효하며, 장기적으로 관리해야하는 대상이므로 
주기적인 비밀번호 변경이나 액세스키 로테이션 등 추가적인 보안관리가 필요함. 

### 사용사례
* 교차 계정 역할 (Cross-Account Role) : IAM의 기능이지만 한 AWS 계정의 사용자나 서비스가 다른 AWS 계정의 리소스에 접근할 수 있도록 허용하는 기능 -> 일반적인 Role 과는 다르게 보안상의 이유로 <u><font color="#de7802">임시 자격 증명</font></u>이다. (일정기간 후 만료 되도록 설계됨. 역할 자체는 존재하기는함. 그 속의 자격증명만 임시임.)


### 사전지식 2. IAM Policy #IAM/IAM_Policy
IAM에서는 사용자, 그룹, 역할에 대한 관리를 위해 정책(Policy)을 사용한다 

정책은 크게 <font color="#00b050"> 세가지</font> 유형으로 나눌 수 있다. 

#### 1. AWS Managed Policies
AWS는 일반적인 사용사례를 기반으로 제공하는 미리 정의된 정책.
* <font color="#de7802">자동 업데이트</font>: AWS가 정책을 관리하고 새로운 서비스나 기능이 추가되면 업데이트 해줌 
* <font color="#de7802">손쉬운 사용</font> : AWS가 관리해주니 관리부담이 적고 빠르게 설정 가능
* <font color="#de7802">읽기 전용</font> : AWS가 관리하기 때문에 수정(custom) 이 불가능-> 커스텀이 필요하면 Customer Managed Policy 를 생성 할 수 있다. 
<u>EX) : AmazonS3ReadOnlyAccess, AmazonEC2FullAccess </u>
#### 2. Customer Managed Policies
고객이 직접 생성하고 관리하는 정책.
* <font color="#de7802">커스터마이징 가능</font> : AWS Managed Policies 과는 다르게 수정할 수 있음. 
* <font color="#de7802">버전 관리</font> : 정책(Policy)의 여러 버전을 만들고 관리 할 수 있음. (커스터마이징의 주체가 고객이니 당연)
* <font color="#de7802">재사용 가능</font> : 여러사용자, 그룹, 역할에 쉽게 할당 할 수 있다. (재사용 뿐만 아니라 상황에 맞게 커스텀가능)
* <font color="#de7802">관리 책임</font> : 정책의 관리와 유지보수는 고객의 책임                    (커스터마이징의 주체가 고객이니 당연)
<u>EX) : 특정 S3 버킷에 대한 읽기/쓰기 권한을 부여하는 정책 등 </u>

#### 3. Inline Policies
특정 사용자, 그룹, 역할(이하 <font color="#de7802">엔티티</font>로 서술)에 직접 연결된 정책. 정책이 연결된 <font color="#de7802">엔티티와 생명주기를 공유한다. </font>
* <font color="#de7802">직접 연결</font> : 특정 엔티티에 직접 연결되며, 해당 엔티티 삭제되면 정책도 삭제됨. 
* <font color="#de7802">고유성</font> : 재사용되지 않으며, 특정 엔티티에만 적용됨.
* <font color="#de7802">관리 부담</font> : 여러 엔티티에 걸쳐 동일한 정책을 적용할 때 관리부담이 증가 할 수 있음.
(엔티티가 한 두개가 아닐거니깐 개별설정 시  관리부담 됨)
* <font color="#de7802">유연성</font> : 특정 상황에 맞게 세부적으로 권한을 설정할 수 있다. 
<u>EX) : 특정 역할(Role)에만 적용되는 정책 등</u>

### 사전지식 3. AWS Service Roles

AWS Service Roles 는 AWS 서비스가 다른 AWS 리소스에 접근하거나 작업을 수행 할 수 있도록 받는 역할(Role)을 의미하며 영구적

### 사전지식 4. EC2 Instance Role

<font color="#00b050">하나의 AWS EC2 인스턴스는 하나의 IAM Role만 가질 수 있다. </font>














