### 컨테이너의 생명주기와 도커 커맨드

* 이미지 : 컨테이너의 모형이 되는 것으로 실행되기 전의 상태이다. 
* 실행     : 실행이라는 말은 이미지가 호스트의 컴퓨팅 자원을 할당받아 독립적인 서버 인스턴스(=컨테이너)를 만든다는 의미이다. 이 컨테이너는 호스트로 부터 PID를 할당 받는다. => 컨테이너마다 서로 다른 PID를 가지며 각 컨테이너는 독립적인 PID네임스페이스를 가진다. 
* 정지     : 프로세스의 종료코드, 로그가 보조된 채 정지한 상태다 

#### (1) .  이미지 다운로드(docker pull)
```shell
docker pull centos:7

```

#### (2). 컨테이너의 실행(docker run)
```shell
docker run -it --name test1 centos:7 bash

ps -ef

UID        PID  PPID  C STIME TTY      TIME CMD
root         1     0  0 12:00 pts/0    00:00:00 /bin/bash
root         7     1  0 12:00 pts/0    00:00:00 ps -ef

```
	 (1) docker run  : 새로운 컨테이너를 만들고 실행 한다. 
	 (2) 옵션 -t (tty : TeletypeWriter) : 생성될 컨테이너 내부의 쉘과 사용자(호스트)가 상호작
	  용할 수 있게 컨테이너에 가상터미널을 할당한다. 
	 (2-1) 옵션 -i (interactive)          : 표준입력을 유지하여 컨테이너와의 상호작용을 할 
	  수 있게 한다.  -> 안쓰면 컨테이너가 백그라운드에서 실행되고 상호작용이 불가함. 
	 정리!!  ->  옵션 -it : 컨테이너가 생성되면 컨테이너 내부의 쉘과 호스트가 대화할 수 있는 가
	 상의 터미널을 만들어주고(-t 옵션) , 만들어진 가상의 터미널에 표준입력을 할 수 있도록 함으로
	 서 컨테이너 내부의 쉘에 질의할 수 있도록 해준다.
	 (3) --name test1 : 생성할 컨테이너의 이름을 뜻함. 이 이름은 시스템에서 유일한 이름이어야하
	  며 지정안하면 자동으로 만들어진다.
	 (4) centos:7
	  '사용할 도커 이미지 이름 : 버전' 로컬에 이미지가 없으면 원격 리포지토리에서 이미지를 다운
	  로드한다. 일반적으로 기본 설정된 원격리포지토리는 도커허브(docker Hub)이다. 
	  로컬에 이미지 존재여부 확인하려면?     : 'docker images' 
	  원격리포지토리 설정된 내용 확인하려면?  : 'docker info' -> Registry :https://~~~찾기
	  (5) bash
	  컨테이너생성시 bash쉘이 실행되고 가상터미널이 연결된다.(ps -ef 에서 1번 PID에서 TTY필드
	  확인하면 가상터미널이 할당된것을 확인할 수 있다.)
	  (6 그냥 추가함) --rm 
	   컨테이너가 종료하면 종료상태의 컨테이너를 자동으로 삭제한다. 

#### (3). 컨테이너의 상태출력(docker ps)
docker ps 에서 ps는 **process status** 를 의미하며 실행중인 컨테이너 목록을 출력한다.
옵션 -a : 'docker ps -a ' 는 실행중 + 정지된 컨테이너의 목록을 보여준다. 

#### (4). 로그 출력(docker logs)
정지상태의 컨테이너는 삭제될 때까지 남아있으며, 실행중 발생한 표준출력과 표준에러출력을 가지고 있다. 
`docker logs 컨테이너ID | 컨테이너명`

>[!question] 표준출력과 표준에러출력
>리눅스에선 출력을 표준출력, 표준에러출력(Standard Error, stderr) 두가지로 출력 스트림을 나누고 있다. 이렇게 나눔으로서 정상결과와 에러결과를 쉽게 구분할 수있고 이에 대한 분기처리또한 용이하다. 

```shell
#!/bin/bash

# 표준출력 리다이렉트 = overwrite(새롭게 만들거나, 기존내용을 덮어쓴다)
echo "처리중입니다..." > output.log

# 파일 읽기(존재하지 않은 파일의 경우) 표준에러출력 리다이렉트(리다이렉트 에러)
cat nonexistent_file.txt 2> error.log

# 분기처리
if[$? -ne 0]; then
	echo "오류 발생 error.log 확인 필요" 
fi

# >> 는 리다이렉트 and append(기존내용뒤에 추가된다는 의미)
# 2>> 는 리다이렉트 and append 에러 라고 읽는다. 
echo "이후 작업진행" >> output.log

```

##### $? : 직전 명령의 종료상태
여기서 말하는 명령은 리다이렉션을 제외한 명령을 말하며 리다이렉션 과정에서 문제가 발생해도 리다이렉션 바로 전 명령어가 성공했다면 0 (성공)을 반환한다. 
(ex 쓰기권한이 없는 디렉토리로 리다이렌트 시도하거나 존재하지 않은 경로에 리다이렉트 시도하는 경우)

#### (5). 컨테이너 정지(docker stop, docker kill)
실행중인 컨테이너를 정지시키는 방법은 다음과 같다. 

	1. 컨테이너의 PID = 1 인 프로세스를 종료한다.
	2. 'docker stop 컨테이너ID | 컨테이너명' 을 실행한다. 
	3. 'docker kill 컨테이너ID | 컨테이너명' 을 실행한다. 

**PID = 1** 
init 프로세스로 현대에서는 systemd, upstart 와 같은 대체 init 시스템이 사용된다. 
시스템에서 가장먼저 실행되는 프로세스이며, 모든 다른 프로세스의 부모프로세스이다. 
초기화 과정에서 커널이  이 프로세스를 실행하고 이후 시스템에서 모든 다른 프로세스를 생성한다. 시스템의 부팅과 종료를 관리하며 자식프로세스의 종료상태를 수집하여 리소스를 정리한다. 

